{% extends 'layout.html' %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <a href="{{ model.referer }}" class="govuk-back-link govuk-!-margin-bottom-7">Back</a>
    <h1 class="govuk-heading-xl">
      <span class="govuk-caption-xl">River level at</span>
      {{ model.station.name }} ({{ model.station.river }})
    </h1>
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {% if model.station.isClosed or model.station.isClosed or model.station.isSuspended %}
    <p>
      {% if model.station.isClosed %}
      This station is closed and no data is available.
      {% elif model.recentValue.err %}
      The latest level recorded is unreliable.
      {% elif model.station.isSuspended %}
      {{ model.station.statusReason if model.station.statusReason else "This station is temporarily closed and no data is available." }}
      {% endif %}
    </p>
    {% endif %}
  </div>
</div>

{% if model.station.isActive %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-third"> 
    <p role="text" class="govuk-!-padding-bottom-4">
      <span class="govuk-caption-m">Latest level</span>
      <strong class="govuk-heading-l govuk-!-margin-bottom-1">Normal</strong>
      <span class="govuk-body">{{ (model.station.recentValue._).toFixed(2) }}m (typical {{ model.station.percentile95 }}m - {{ model.station.percentile5 }}m)</span>
    </p>
  </div>
  <!--
    <div class="station-data__item">
      <span class="station-data__icon"></span>
      <div class="station-data__copy">
        <span class="station-data__item-name">Current trend</span>
        <strong class="station-data__item-value">Stable</strong>
        <span class="station-data__item-secondary">Forecast within typical range</span>
      </div>
    </div>
  -->
  <div class="govuk-grid-column-one-third"> 
    <p role="text" class="govuk-!-padding-bottom-4">
      <span class="govuk-caption-m">Last updated</span>
      <time datetime="" class="govuk-heading-l govuk-!-margin-bottom-1">{{ model.station.recentValue.formattedTime }}</time>
      <span class="govuk-body">{{ model.station.recentValue.dateWhen }}</span>
    </p>
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <!--
      If D3 available (Javascript, SVG or VML)
      remove hidden class and hidden attribute
    -->
    <figure class="defra-line-chart govuk-!-margin-bottom-4">
      <figcaption class="defra-line-chart__caption">Level measured over the last 5 days {% if model.isFfoi %}and next 36 hours{% endif %}</figcaption>
      <div id="line-chart" class="defra-line-chart__container" role="presentation" aria-hidden="true" hidden></div>
    </figure>
    <!--
      End D3 available
    -->
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <p class="govuk-!-margin-bottom-6">Find out <a href="">how river, sea and groundwater levels are measured</a>.</p>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h2 class="govuk-heading-m">What effect could the level here have on nearby areas?</h2>
    <table class="defra-table-impact govuk-table govuk-!-font-size-16 govuk-!-margin-bottom-7">
      <caption class="govuk-table__caption govuk-visually-hidden">Months and rates</caption>
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th class="govuk-table__header" scope="col">Level</th>
          <th class="govuk-table__header" scope="col">Description</th>
          <th class="govuk-table__header" scope="col"></th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for impact in model.impacts %}
        <tr class="defra-table-impact__row govuk-table__row" data-id="{{ impact.impactid }}" data-level="{{ impact.value }}" data-name="{{ impact.shortname }}">
          <th class="govuk-table__header" scope="row">{{ impact.value }}m</th>
          <td class="govuk-table__cell">{{ impact.description }} {% if impact.obsfloodmonth and impact.obsfloodyear %}({{ impact.obsfloodmonth }} {{ impact.obsfloodyear }}){% endif %}</td>
          <td class="govuk-table__cell"><button class="defra-button-text-s">Show on chart</button></td>
        </tr>   
        {% endfor %}
        {% if model.warningThreshold %}
          <tr class="defra-table-impact__row govuk-table__row" data-id="warning" data-level="{{ model.warningThreshold }}" data-name="Flood warning threshold">
            <th class="govuk-table__header" scope="row">{{ model.warningThreshold }}m</th>
            <td class="govuk-table__cell">Flood warning threshold</td>
            <td class="govuk-table__cell"><button class="defra-button-text-s">Show on chart</button></td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <details class="govuk-details">
      <summary class="govuk-details__summary">
        <span class="govuk-details__summary-text">
          View technical details about this gauging station
        </span>
      </summary>
      <div class="govuk-details__text">
        <dl class="govuk-summary-list">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Station name</dt><dd class="govuk-summary-list__value">Ebley Mill</dd>
            <dt class="govuk-summary-list__key">Station ID:</dt><dd class="govuk-summary-list__value">2019</dd>
            <dt class="govuk-summary-list__key">Site datum:</dt><dd class="govuk-summary-list__value">30.88mAOD (what does this mean?)</dd>
          </div>
        </dl>
      </div>
    </details>
  </div>
</div>

{% endif %}
{% endblock %}

{% block bodyEnd %}
{{ super() }}
<script src="{{ assetPath }}/nunjucks-slim.min.js"></script>
<script>nunjucks.configure()</script>
<script src="/assets/javascripts/d3.v5.min.js"></script>
<script src="/assets/javascripts/components/charts.js"></script>
<script>
  window.flood.model = {{ model | dump(2) | safe }}
</script>
<script src="{{assetPath}}/javascripts/pages/station.js"></script>
{% endblock %}
