{% extends 'layout.html' %}

{% macro severity(panel) %}
<div class="accordion__section" id="{{panel.name}}">
  <div class="accordion__section-container">
    <div class="accordion__section-header">
      <h2 class="accordion__section-title">
        {{panel.title}}
      </h2>
      <p class="accordion__description">{{panel.description}}</p>
    </div>
    <div class="accordion__section-content" id="{{panel.name}}-content">
      {% if panel.floods %}
        <ul class="govuk-list govuk-list--warning">
          {% for flood in panel.floods %}
            <li><a href="/target-area/{{flood.code}}">{{ flood.description }}</a></li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>
</div>
{% endmacro %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-2">
      <span class="govuk-caption-xl">Flood risk</span>{{ model.location }}
    </h1>
    <p class="govuk-body govuk-!-margin-bottom-8">
      <a href="/">Change location</a> | <a href="/national">Flood risk for England</a></p>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <div id="warnings">
      <!-- Headline statement -->
      {% if model.hasActiveFloods %}
        <div class="govuk-warning-text govuk-warning-text--{{model.highestSeverity.hash}}">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
          <strong class="govuk-warning-text__text">
            <span class="govuk-warning-text__assistive">{{model.highestSeverity.title}}</span>
            {{model.highestSeverity.subTitle}}<!-- - {{model.highestSeverity.tagline.toLowerCase()}} -->
          </strong>
        </div>
        <p>{{model.floodsSummary}}</p>
        <p>Find out what to do if you live in a flood warning or alert area.</p>

      {% else %}
        <p class="govuk-!-margin-bottom-0">
          There are currently no flood warnings or alerts in this area
        </p>
      {% endif %}

      {% if model.groupedFloods.length %}
        <details class="govuk-details govuk-!-margin-bottom-4">
          <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text">View flood warnings and alerts</span>
          </summary>
          <div class="govuk-details__text">
            {% for group in model.groupedFloods %}
              <h2 class="govuk-heading-s govuk-!-margin-bottom-1">{{group.severity.pluralisedTitle}}</h2>
              <ul class="govuk-list govuk-list--warning">
                {% for flood in group.floods %}
                  <li><a href="/target-area/{{flood.code}}">{{flood.description}}</a></li>
                {% endfor %}
              </ul>
            {% endfor %}
          </div>
        </details>
      {% endif %}

      <div class="govuk-inset-text govuk-!-margin-top-0">
        <p>If you live in this area you may be able to <a href="https://www.gov.uk/sign-up-for-flood-warnings">get flood warnings by phone, text or email</a>. This service is free.</p>
      </div>

      <p class="govuk-body-s govuk-caption--body govuk-!-margin-top-4">
        <span class="govuk-body--caption">
          <time class="form-hint" title="{{model.timestamp | formatDate}}"
            datetime="{{model.timestamp}}">Last updated {{model.timestamp | formatDate}}</time>
        </span>
      </p>

    </div>
  </div>
</div>

{% if model.rivers %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-m govuk-!-margin-top-4">River levels that impact this area</h2>
    <details class="govuk-details">
      <summary class="govuk-details__summary">
        <span class="govuk-details__summary-text">View river levels</span>
      </summary>
      <div class="govuk-details__text">
        {% for name, river in model.rivers %}
          <p class="govuk-body govuk-!-margin-bottom-1">{{name}}</p>
          <ul class="govuk-list govuk-list--level">
            {% for station in river %}
              <li>
                <a title="{{station.name}}"
                  href="/station/{{station.rloi_id}}">{{station.external_name}}</a>
              </li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
    </details>
  </div>
</div>
{% endif %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    {% include "partials/map.html" %}
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <div class="govuk-inset-text govuk-!-margin-top-6">
      <p>Parts of this area may experience flooding from other sources in the future. <a href="https://flood-warning-information.service.gov.uk/long-term-flood-risk">View
          long term flood risk information for this area</a>.</p>
    </div>
    {% include "partials/before-during-after.html" %}
  </div>
</div>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}
  <script src="{{assetPath}}/javascripts/ol.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps-styles.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps-layers.js"></script>
  <script src="{{assetPath}}/javascripts/components/map-container.js"></script>
  <script src="{{assetPath}}/javascripts/components/main-map.js"></script>
  <script>
    window.flood.model = {{ model | dump(2) | safe }}
  </script>
  <script src="{{assetPath}}/javascripts/pages/location.js"></script>
{% endblock %}
