{% extends 'layout.html' %}

{% macro severity(panel) %}
<div class="accordion__section" id="{{panel.name}}">
  <div class="accordion__section-container">
    <div class="accordion__section-header">
      <h2 class="accordion__section-title">
        {{panel.title}}
      </h2>
      <p class="accordion__description">{{panel.description}}</p>
    </div>
    <div class="accordion__section-content" id="{{panel.name}}-content">
      {% if panel.floods %}
        <ul class="govuk-list govuk-list--warning">
          {% for flood in panel.floods %}
            <li><a href="/target-area/{{flood.code}}">{{ flood.description }}</a></li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>
</div>
{% endmacro %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-2">
      <span class="govuk-caption-xl">Flood risk</span>{{ model.location }}
    </h1>
    <p class="govuk-body govuk-!-margin-bottom-8">
      <a href="/">Change location</a> | <a href="/national">Flood risk for England</a></p>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <div id="warnings" class="govuk-!-margin-bottom-4">
      <!-- Headline statement -->
      {% if model.primarySeverity %}
        <div class="govuk-warning-text govuk-warning-text--{{model.primarySeverity.hash}}">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
          <strong class="govuk-warning-text__text">
            <span class="govuk-warning-text__assistive">{{model.primarySeverity.title}}</span>
            {{model.primarySeverity.subTitle}}
          </strong>
        </div>

        <!-- Primary message -->
        <p>
          {% if model.primaryFloods.length == 1 %}
            {{model.primarySeverity.title}} in force for 
              <a href="/target-area/{{model.primaryFloods[0].code}}">{{ model.primaryFloods[0].description }}</a>.
          {% elif model.primaryFloods.length == 2 %}
            {{model.primarySeverity.pluralisedTitle}} in force for 
              <a href="/target-area/{{model.primaryFloods[0].code}}">{{ model.primaryFloods[0].description }}</a> 
              and  <a href="/target-area/{{model.primaryFloods[1].code}}">{{ model.primaryFloods[1].description }}</a>.
          {% else %}
            {{model.primaryFloods.length}} {{model.primarySeverity.pluralisedTitle.toLowerCase()}} are in force.
          {% endif %}

          <!-- Primary message action -->
          {% switch model.primarySeverity.id %}
            {% case 1 %}
              You must <a href="/">act now</a> if you live in an affected area.
            {% case 2 %}
              You need to <a href="/">take action</a> if you live in an affected area.
            {% case 3 %}
              You need to <a href="/">prepare</a> if you live in an affected area.
          {% endswitch %}

          <!-- Primary floods list -->
          {% if model.primaryFloods.length > 2 %}
            <details class="govuk-details">
              <summary class="govuk-details__summary">
                <span class="govuk-details__summary-text">{{model.primarySeverity.pluralisedTitle}}</span>
              </summary>
              <div class="govuk-details__text">
                <ul class="govuk-list govuk-list--warning">
                  {% for flood in model.primaryFloods %}
                    <li><a href="/target-area/{{flood.code}}">{{flood.description}}</a></li>
                  {% endfor %}
                </ul>
              </div>
            </details>
          {% endif %}
        </p>

        <!-- Secondary message -->
        {% if model.secondaryMessage %}
          <p>
            {{model.secondaryMessage}}
          </p>
        {% endif %}

        <!-- Expired message -->
        {% if model.expiredMessage %}
          <p>
            {{model.expiredMessage}}
          </p>
        {% endif %}

        {% if model.hasSecondaryFloods or model.hasInactiveFloods %}
          <details class="govuk-details govuk-!-margin-bottom-4">
            <summary class="govuk-details__summary">
              <span class="govuk-details__summary-text">View additional warnings</span>
            </summary>
            <div class="govuk-details__text">
              {% if model.hasSecondaryFloods %}
                {% for group in model.activeSecondaryGroups %}
                <p class="govuk-body govuk-!-margin-bottom-1">{{group.severity.pluralisedTitle}}</p>
                <ul class="govuk-list govuk-list--warning">
                  {% for flood in group.floods %}
                    <li><a href="/target-area/{{flood.code}}">{{flood.description}}</a></li>
                  {% endfor %}
                </ul>
                {% endfor %}
              {% endif %}
              {% if model.hasInactiveFloods %}
                <p class="govuk-body govuk-!-margin-bottom-1">{{model.expiredSeverity.pluralisedTitle}}</p>
                <ul class="govuk-list govuk-list--warning">
                  {% for flood in model.inactiveFloods %}
                    <li><a href="/target-area/{{flood.code}}">{{flood.description}}</a></li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          </details>
        {% endif %}
      {% else %}
        <h1 class="govuk-heading-l">No flood warnings in place</h1>
        <p>There are no flood warnings in force in this area.</p>
      {% endif %}

      <p class="govuk-body-s govuk-!-margin-top-4">
        <span class="govuk-body--caption">
          <time class="form-hint" title="{{model.timestamp | formatDate}}"
            datetime="{{model.timestamp}}">Last updated {{model.timestamp | formatDate}}</time>
        </span>
      </p>

      <div class="govuk-inset-text govuk-!-margin-top-4">
        <p>If you live in this area you may be able to get flood warnings by phone, text or email. <a href="https://www.gov.uk/sign-up-for-flood-warnings">Sign
            up for flood warnings</a></p>
      </div>
    </div>
  </div>
</div>

{% if model.rivers %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-m">River levels that impact this area</h2>
    <details class="govuk-details">
      <summary class="govuk-details__summary">
        <span class="govuk-details__summary-text">View river levels</span>
      </summary>
      <div class="govuk-details__text">
        {% for name, river in model.rivers %}
          <p class="govuk-body govuk-!-margin-bottom-1">{{name}}</p>
          <ul class="govuk-list govuk-list--level">
            {% for station in river %}
              <li>
                <a title="{{station.name}}"
                  href="/station/{{station.rloi_id}}">{{station.external_name}}</a>
              </li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
    </details>
  </div>
</div>
{% endif %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <figure class="map map--large map--embedded" id="map-now">
      <div class="map__container">
        <div class="map__container-inner">
          {% include "partials/key.html" %}
        </div>
      </div>
      <figcaption class="govuk-visually-hidden">Flood warnings and river and sea levels</figcaption>
    </figure>
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <div class="govuk-inset-text govuk-!-margin-top-4">
      <p>If you live in this area you may be able to get flood warnings by phone, text or email. <a href="https://www.gov.uk/sign-up-for-flood-warnings">Sign
          up for flood warnings</a></p>
      <p>Parts of this area may experience flooding from other sources in the future. <a href="https://flood-warning-information.service.gov.uk/long-term-flood-risk">View
          long term flood risk information for this area</a>.</p>
    </div>
    {% include "partials/before-during-after.html" %}
  </div>
</div>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}
  <script src="{{assetPath}}/javascripts/ol.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps.js"></script>
  <script src="{{assetPath}}/javascripts/components/map-container.js"></script>
  <script src="{{assetPath}}/javascripts/components/accordion.js"></script>
  <script>
    window.Flood.model = {{ model | dump(2) | safe }}
  </script>
  <script src="{{assetPath}}/javascripts/pages/location.js"></script>
{% endblock %}
