{% extends 'layout.html' %}

{% macro severity(panel) %}
<div class="accordion__section" id="{{panel.name}}">
  <div class="accordion__section-container">
    <div class="accordion__section-header">
      <h2 class="accordion__section-title">
        {{panel.title}}
      </h2>
      <p class="accordion__description">{{panel.description}}</p>
    </div>
    <div class="accordion__section-content" id="{{panel.name}}-content">
      {% if panel.floods %}
        <ul class="govuk-list govuk-list--warning">
          {% for flood in panel.floods %}
            <li><a href="/target-area/{{flood.code}}">{{ flood.description }}</a></li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  </div>
</div>
{% endmacro %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <nav class="defra-search-link">
      <p>
        <a href="/"><span class="defra-search-link__icon"></span>Change location</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="/national">See the national view</a>
      </p>
    </nav>
  </div>
</div>

<hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-top-2 govuk-!-margin-bottom-7">

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">
      Flood risk {{ model.location }}
      <span class="govuk-caption-m">
        <time class="form-hint" title="{{model.timestamp | formatDate}}"
        datetime="{{model.timestamp}}">{{model.timestamp | formatDate}}</time>        
      </span>
    </h1>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <!-- Headline statement -->
    {% if model.hasActiveFloods %}
      <div class="govuk-warning-text govuk-warning-text--{{model.highestSeverity.hash}}">
        <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
        <strong class="govuk-warning-text__text">
          <span class="govuk-warning-text__assistive">{{model.highestSeverity.title}}</span>
          {{model.highestSeverity.subTitle}}<!-- - {{model.highestSeverity.tagline.toLowerCase()}} -->
        </strong>
      </div>
      <p class="govuk-body-m">
        {{ model.floodsPrimary | safe }}
      </p>
    {% else %}
      <p class="govuk-body-m">
        There are currently no flood warnings or alerts in force in this area
      </p>
    {% endif %}
    {% if model.hasFloodsSecondary %}
      <p class="govuk-body-m">
        {{ model.floodsSecondary | safe }}
      </p>
    {% endif %}
    {% if model.hasAllFloodsList %}
      <details class="defra-flood-details govuk-!-margin-bottom-6">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">View all flood warnings and alerts</span>
        </summary>
        <div class="govuk-details__text">
          {% for group in model.groupedFloods %}
            <h2 class="defra-flood-details__section-heading">
              {{group.severity.pluralisedTitle}}
              <span class="govuk-caption-m govuk-caption--normal">{{group.severity.subTitle}}</span>
            </h2>
            <ul class="defra-targetareas-list">
              {% for flood in group.floods %}
                <li>
                  <a href="/target-area/{{flood.code}}">{{flood.description}}</a><br/>
                  <!--<span class="govuk-body-s">Issued 00:00, 28 Jan</span>-->
                </li>
              {% endfor %}
            </ul>
          {% endfor %}
        </div>
      </details>
    {% endif %}

    {% if not model.hasActiveFloods %}
      <details class="govuk-details govuk-!-margin-top-6">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">Were you expecting to see a flood warning or alert here?</span>
        </summary>
        <div class="govuk-details__text">
          <p class="govuk-body">You might have been looking at this location because you received a message saying there was:</p>
          <ul class="govuk-list govuk-list--bullet">
            <li>a severe flood warning</li>
            <li>a flood warning</li>
            <li>a flood alert</li>
          </ul>
          <p class="govuk-body">We provide flood updates in many ways. Sometimes there can be a few minutes' delay before the latest information is shown.</p>
          <p class="govuk-body">Please check regularly to get the latest information. You can do this by refreshing this page using your browser.</p>
        </div>
      </details>
    {% endif %}

  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="app-map govuk-!-margin-bottom-2">
      <div class="app-map__container">
        <figure class="map" id="map-live">
          <div class="map__container">
            <div class="map__container-inner"></div>
          </div>
          <figcaption class="govuk-visually-hidden">Map showing flood warnings; river and sea levels and rainfall measurements</figcaption>
        </figure>
      </div>
    </div>
  </div>
</div>

{% if model.rivers %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <div class="govuk-inset-text">
      <p>If you live in this area you may be able to <a href="https://www.gov.uk/sign-up-for-flood-warnings">get flood warnings by phone, text or email</a>. This service is free.</p>
    </div>
    <h2 class="govuk-heading-m">Water levels that impact this area</h2>
    <p class="govuk-body">River, sea and groundwater levels are regularly checked by a network of monitoring stations. These levels can help you understand your flood risk now and in the next few days.</p>
    <details class="govuk-details">
      <summary class="govuk-details__summary">
        <span class="govuk-details__summary-text">View river and sea levels in this area</span>
      </summary>
      <div class="govuk-details__text">
        {% for name, river in model.rivers %}
          <p class="govuk-body govuk-!-margin-bottom-1">{{name}}</p>
          <ul class="govuk-list govuk-list--level">
            {% for station in river %}
              <li>
                <a title="{{station.name}}"
                  href="/station/{{station.rloi_id}}">{{station.external_name}}</a>
              </li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>
    </details>
    <details class="govuk-details">
      <summary class="govuk-details__summary">
        <span class="govuk-details__summary-text">View impacts in this area</span>
      </summary>
      <div class="govuk-details__text">
        {% if model.impacts and ( model.impacts | length > 0 ) %}
        {% for impact in model.impacts %}
          <p>{{ impact.description }}<br />Source: <a href="/station/{{ impact.rloiId }}">{{ impact.gauge }}</a></p>
        {% endfor %}
        {% else %}
          <p>No impacts for this area.</p>
        {% endif %}
      </div>
    </details>
  </div>
</div>

<hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-7">
{% endif %}

<section class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-m">Long term flood risk</h2>
    <p>This area could be affected by flooding in the future. <a href="https://flood-warning-information.service.gov.uk/long-term-flood-risk">View the long term flood risk information for a location in England</a>.</p>
  </div>
</section>
    
<hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-top-2 govuk-!-margin-bottom-7">

<section class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-m">What to do before, during and after a flood</h2>
    <ul class="govuk-list govuk-!-margin-bottom-0">
      <li><a class="govuk-link" href="/plan-ahead-for-flooding">How to plan ahead for flooding</a></li>
      <li><a class="govuk-link" href="/what-to-do-in-a-flood/what-the-flood-warnings-mean">What to do in a flood</a></li>
      <li><a class="govuk-link" href="/recovering-after-a-flood">How to recover after a flood</a></li>
    </ul>
  </div>
</section>

<hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-top-6 govuk-!-margin-bottom-7">

<section class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-m">Other ways to check your current flood risk</h2>
    <p class="govuk-body">
      <strong class="govuk-!-font-weight-bold">Floodline</strong><br />
      Telephone: 0345 988 1188<br />
      Type talk: 0345 602 6340 (for the hard of hearing)<br />
      24-hour service<br>
      <a class="govuk-link" href="https://gov.uk/call-charges">Find out more about call charges</a>.
    </p>
  </div>
</section>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}
  <script src="{{assetPath}}/javascripts/ol.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps-styles.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps-layers.js"></script>
  <script src="{{assetPath}}/javascripts/components/map-container.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps/live.js"></script>
  <script src="{{assetPath}}/javascripts/templates.js"></script>
  <script src="{{ assetPath }}/nunjucks-slim.min.js"></script>
  <script>nunjucks.configure()</script>
  <script>
    window.flood.model = {{ model | dump(2) | safe }}
  </script>
  <script src="{{assetPath}}/javascripts/pages/location.js"></script>
{% endblock %}
