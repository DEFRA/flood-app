{% extends 'layout.html' %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <nav class="defra-search-link govuk-!-margin-bottom-7">
      <p>
        <a href="/"><span class="defra-search-link__icon"></span>Change location</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="/national">National view</a>
      </p>
    </nav>
  </div>
</div>

<!--<hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-top-2 govuk-!-margin-bottom-7">-->

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl">
      Flood risk for {{ model.location }}
      <span class=""></span>
    </h1>

    <!-- Flood alerts or warnings in force -->
    {% if model.hasActiveFloods %}
      <div class="govuk-warning-text govuk-warning-text--{{model.highestSeverity.hash}}">
        <span class="govuk-warning-text__icon"></span>
        <strong class="govuk-warning-text__text">
          <span class="govuk-warning-text__assistive">{{model.highestSeverity.title}}</span>
          {{model.highestSeverity.subTitle}}<!-- - {{model.highestSeverity.tagline.toLowerCase()}} -->
        </strong>
      </div>
      <p class="govuk-body-m">
        {{ model.floodsPrimary | safe }}{{ model.floodsSecondary | safe }}
        {% if not model.hasFloodsList %}
        <span id="map-list-warnings"></span>
        {% endif %}
      </p>
      
      {% if model.hasFloodsList %}
      <div id="map-list-warnings" class="defra-map-list govuk-!-margin-bottom-4">
        <div id="warnings-detail" class="govuk-details__text govuk-details__text--defra-details-flood">
          {% for group in model.groupedFloods %}
            <h2 class="govuk-heading-s govuk-!-padding-top-0 govuk-!-margin-bottom-3">
              {{group.severity.pluralisedTitle}}
              <br/>
              <span class="govuk-!-font-weight-regular">{{group.severity.subTitle}}</span>
            </h2>
            <ul class="defra-list-flood">
              {% for flood in group.floods %}
                <li class="defra-list-flood__item">
                  <a href="/target-area/{{flood.code}}">{{flood.description}}</a>
                  <!--
                  <div class="defra-list-flood__meta">
                    Updated: 00:00, 28 Jan 2019
                  </div>         
                  -->
                </li>
              {% endfor %}
            </ul>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    {% else %}
    <p class="govuk-body-m">There are currently no flood warnings or alerts in force in this area as of <time class="form-hint" title="{{model.timestamp | formatDate}}"
      datetime="{{model.timestamp}}">{{model.timestamp | formatDate}}</time>.</p>
    {% endif %}

    {% if ( model.activeImpacts | length > 0 ) %}
    <p class="govuk-body">Historic records show {{ model.activeImpacts.length }} flood impacts occured in this area when river levels previously reached their current height.</p>
    <div id="map-list-impacts" class="defra-map-list govuk-!-margin-bottom-4">
      <div id="impact-detail" class="govuk-details__text govuk-details__text--defra-details-flood">
        <ul class="defra-list-flood">
          {% for impact in model.activeImpacts %}
          <li class="defra-list-flood__item">
            {{ impact.description }}
            <div class="defra-list-flood__meta">
              Source: <a href="/station/{{ impact.rloiid }}?i={{ impact.impactid }}">{{ impact.gauge }}</a>
            </div>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}

    <div class="govuk-inset-text">
      <p class="govuk-body">If you live near a river or the coast you may be able to <a href="https://www.gov.uk/sign-up-for-flood-warnings">get flood warnings by phone, text or email</a>. This service is free.</p>
    </div>

    {% if model.rivers %}
    <h2 class="govuk-heading-m">River and sea levels</h2>
    <p class="govuk-body">River and sea levels are regularly checked by a network of monitoring stations. These levels can help you understand flood risk now and in the next few days.</p>
    <div id="map-list-stations" class="defra-map-list govuk-!-margin-bottom-4">
      <div id="level-detail" class="govuk-details__text govuk-details__text--defra-details-flood">
        {% for name, river in model.rivers %}
        <h2 class="govuk-heading-s govuk-!-margin-bottom-3">{{name}} at:</h2>
        <ul class="defra-list-flood">
          {% for station in river %}
          <li class="defra-list-flood__item">
            <a href="/station/{{station.rloi_id}}">{{station.external_name}}</a>
            <div class="defra-list-flood__meta">
              Level: &lt;High/Normal/Low&gt;<!--, Trend: &lt;Rising/Stable/Falling&gt;-->, Updated: &lt;00:00am&gt;
            </div>
          </li>
          {% endfor %}
        </ul>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <h2 class="govuk-heading-m">Report a flood</h2>
    <p class="govuk-body">Flooding can also be caused by surface water, burst water mains or overflowing drains.</p>
    <p class="govuk-body">You can <a href="https://www.gov.uk/report-flood-cause">report a flood or possible cause of flooding</a>.</p>

    <h2 class="govuk-heading-m">Other ways to check your current flood risk</h2>
    <p class="govuk-body">For river and sea flooding, call the 24-hour Floodline service.</p>
    <p class="govuk-body">
      Telephone: 0345 988 1188<br />
      Type talk: 0345 602 6340 (for the hard of hearing)<br />
      <a class="govuk-link" href="https://gov.uk/call-charges">Find out more about call charges</a>.
    </p>
    <p class="govuk-body">If you are not sure of the source of flooding <a href="https://www.gov.uk/find-local-council">contact your Local Council</a>.</p>
    
  </div>
  <div class="govuk-grid-column-one-third">
    <!-- The Related items component is not part of GOV.UK Frontend but will be styled if used in the Prototype Kit -->
    <aside class="app-related-items" role="complementary" style="border-width:2px">
      <h2 class="govuk-heading-s" id="subsection-title">
        Related content
      </h2>
      <nav role="navigation" aria-labelledby="subsection-title">
        <ul class="govuk-list govuk-!-font-size-16">
          <li>
            <a class="govuk-link" href="/plan-ahead-for-flooding">
              How to plan ahead for flooding
            </a>
          </li>
          <li>
            <a class="govuk-link" href="/what-to-do-in-a-flood/what-the-flood-warnings-mean">
              What to do in a flood
            </a>
          </li>
          <li>
            <a class="govuk-link" href="/recovering-after-a-flood">
              How to recover after a flood
            </a>
          </li>
          <li>
            <a class="govuk-link" href="#">
              View long term flood risk information
            </a>
          </li>
        </ul>
      </nav>
    </aside>
  </div>
</div>

<div class="app-map">
  <div class="app-map__container">
    <div class="map" id="map-live">
      <div class="map__container">
        <div class="map__container-inner"></div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block bodyEnd %}
  {{ super() }}
  <script src="{{assetPath}}/javascripts/ol.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps-styles.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps-layers.js"></script>
  <script src="{{assetPath}}/javascripts/components/map-container.js"></script>
  <script src="{{assetPath}}/javascripts/components/maps/live.js"></script>
  <script src="{{assetPath}}/javascripts/templates.js"></script>
  <script src="{{ assetPath }}/nunjucks-slim.min.js"></script>
  <script>nunjucks.configure()</script>
  <script>
    window.flood.model = {{ model | dump(2) | safe }}
  </script>
  <script src="{{assetPath}}/javascripts/components/map-list.js"></script>
  <script src="{{assetPath}}/javascripts/pages/location.js"></script>
{% endblock %}